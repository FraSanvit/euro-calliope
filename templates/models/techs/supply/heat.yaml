tech_groups:
    heat_storage_small:  # [@DEA:2020] - energy storage - 142 small scale hot water tank - 2050
        essentials:
            name: Small hot water tank
            parent: storage
        constraints:
            energy_cap_per_storage_cap_max: 6.67  # 20kW/3kWh
            storage_loss: 0.021  # fraction / hour
            lifetime: 30
        costs:
            monetary:
                # Source also gives om_prod and purchase costs, but the former is in terms of storage cap
                storage_cap: {{ 0.41e6 * scaling_factors.specific_costs }}  # {{ (1 / scaling_factors.specific_costs) | unit("EUR2015/MWh_heat") }}

    tech_heat_to_demand:
        essentials:
            name: Convert different building heat types to heat for storage
            parent: conversion
            carrier_out: heat

techs:
    methane_boiler:  # [@DEA:2020] - heating installations - 202 Natural gas boiler - 2050
        essentials:
            name: Gas boiler
            parent: conversion
            carrier_in: methane
            carrier_out: methane_heat
        constraints:
            energy_eff: 0.97
            lifetime: 20
        costs:
            monetary:
                # TODO: weight averaging per region based on dwelling ratio
                energy_cap: {{ mean([2.7 / 10, 2.7 / 10, 21.1 / 400, 15.1 / 160]) * 1e6 * scaling_factors.specific_costs }}  # {{ (1 / scaling_factors.specific_costs) | unit("EUR2015/MW_heat") }} | data given per 'unit' with specific capacity, so the equation divides each unit cost by the unit capacity; average of new/existing and single-/multi-family homes.
                om_annual: {{ mean([0.168 / 10, 0.168 / 10, 0.561/ 400, 0.374 / 160]) * 1e6 * scaling_factors.specific_costs }}  # {{ (1 / scaling_factors.specific_costs) | unit("EUR2015/MW_heat/year") }} | average of new/existing and single-/multi-family homes.
    methane_heat_storage_small:
        essentials.parent: heat_storage_small
        essentials.carrier: methane_heat
    methane_tech_heat_to_demand:
        essentials.parent: tech_heat_to_demand
        essentials.carrier_in: methane_heat

    biofuel_boiler:  # [@DEA:2020] - heating installations - 204 Biomass boiler automatic - 2050
        essentials:
            name: Biomass boiler
            parent: conversion
            carrier_in: biofuel
            carrier_out: biofuel_heat
        constraints:
            energy_eff: 0.8
            lifetime: 20
        costs:
            monetary:
                # TODO: weight averaging per region based on dwelling ratio
                energy_cap: {{ mean([5.9 / 10, 5.9 / 8, 76 / 400, 45 / 160]) * 1e6 * scaling_factors.specific_costs }}  # {{ (1 / scaling_factors.specific_costs) | unit("EUR2015/MW_heat") }} | average of new/existing and single-/multi-family homes.
                om_annual: {{ mean([0.42 / 10, 0.42 / 10, 1.343 / 400, 0.889 / 160]) * 1e6 * scaling_factors.specific_costs }}  # {{ (1 / scaling_factors.specific_costs) | unit("EUR2015/MW_heat/year") }} | average of new/existing and single-/multi-family homes.
    biofuel_heat_storage_small:
        essentials.parent: heat_storage_small
        essentials.carrier: biofuel_heat
    biofuel_tech_heat_to_demand:
        essentials.parent: tech_heat_to_demand
        essentials.carrier_in: biofuel_heat

    heat_pump:   # [@DEA:2020] - heating installations - 207.3-6 Air to water & 207.7-10 Ground source - 2050
        essentials:
            name: Heat pump
            parent: conversion
            carrier_in: electricity
            carrier_out: hp_heat
        constraints:
            energy_eff: file=cop-heat-pump.csv  # NOTE: based on data processing pipeline, not [@DEA:2020].
            lifetime: 20
        costs:
            monetary:
                # TODO: weight averaging per region based on dwelling ratio
                energy_cap: {{ (mean([7.6 / 10, 5 / 4, 114 / 400, 57 / 160]) * heat_pump_shares.ashp + mean([12 / 10, 9 / 4, 202 / 400, 72 / 160]) * heat_pump_shares.gshp) * 1e6 * scaling_factors.specific_costs }}  # {{ (1 / scaling_factors.specific_costs) | unit("EUR2015/MW_heat") }} | average of new/existing and single-/multi-family homes | weighted by assumed share of installed GSHP vs ASHP.
                om_annual: {{ (mean([0.222 / 10, 0.222 / 4, 0.761 / 400, 0.761 / 160]) * heat_pump_shares.ashp + mean([0.222 / 10, 0.222 / 4, 0.761 / 400, 0.761 / 160]) * heat_pump_shares.gshp) * 1e6 * scaling_factors.specific_costs }}  # {{ (1 / scaling_factors.specific_costs) | unit("EUR2015/MW_heat/year") }} | average of new/existing and single-/multi-family homes | weighted by assumed share of installed GSHP vs ASHP.
    hp_heat_storage_small:
        essentials.parent: heat_storage_small
        essentials.carrier: hp_heat
    hp_tech_heat_to_demand:
        essentials.parent: tech_heat_to_demand
        essentials.carrier_in: hp_heat

    electric_heater:  # [@DEA:2020] - heating installations - 216 Electric heating - 2050
        essentials:
            name: Electrical heater
            parent: conversion
            carrier_in: electricity
            carrier_out: electric_heater_heat
        constraints:
            energy_eff: 1
            lifetime: 30
        costs:
            monetary:
                # TODO: weight averaging per region based on dwelling ratio
                energy_cap: {{ mean([2.5 / 3, 89 / 160]) * 1e6 * scaling_factors.specific_costs }}  # {{ (1 / scaling_factors.specific_costs) | unit("EUR2015/MW_heat") }} | average of new/existing and single-/multi-family homes.
                om_annual: {{ mean([0.021 / 3, 0.042 / 160]) * 1e6 * scaling_factors.specific_costs }}  # {{ (1 / scaling_factors.specific_costs) | unit("EUR2015/MW_heat/year") }} | average of new/existing and single-/multi-family homes.
    electric_heater_heat_storage_small:
        essentials.parent: heat_storage_small
        essentials.carrier: electric_heater_heat
    electric_heater_tech_heat_to_demand:
        essentials.parent: tech_heat_to_demand
        essentials.carrier_in: electric_heater_heat
